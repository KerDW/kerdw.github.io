<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>backend | Writeup</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../../index.css">
</head>

<body>
  <nav class="top-nav">
    <div class="container">
      <div class="nav-content">
        <div class="nav-left">
          <a href="../../index.html" class="back-link" title="Back to home">‚Üê</a>
          <h1 data-i18n="site-title">KDW_LABS</h1>
        </div>
        <div class="nav-controls">
          <button id="theme-toggle" class="icon-btn" aria-label="Toggle theme">
            <span class="theme-icon">üåô</span>
          </button>
          <button id="lang-toggle" class="icon-btn" aria-label="Toggle language">
            <span>EN</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <main class="container">
    <header class="machine-header">
      <h1 class="machine-title">backend</h1>
      <div class="machine-meta">
        <span class="badge badge-platform">DockerLabs</span>
        <span class="badge badge-difficulty-easy">easy</span>
      </div>
    </header>

    <article class="machine-content">
      <div id="content-en" class="lang-content" style="display:none;">
        <div class="machine-summary">
          <h2 data-i18n="summary-title">Exploitation Summary</h2>
          <p><strong>Exploitation process:</strong> Discovered a blind SQL injection vulnerability in the web login
            form. Using <code>sqlmap</code>, database credentials were extracted, enabling SSH access as the
            <code>pepe</code> user. Once inside, the <code>grep</code> binary was found to have the SUID bit set,
            allowing the reading of sensitive files. Leveraged this to list the contents of the <code>/root</code>
            directory and discovered a <code>pass.hash</code> file. The MD5 hash was cracked using CrackStation,
            revealing the root password and allowing for privilege escalation.</p>
          <p><strong>Technologies/Exploits:</strong> Blind SQLi, SQLMap, SUID Grep, MD5 Crack.</p>
        </div>
        <hr class="summary-divider">
        <p>Nmap:</p>
        <p><img src="./media/image3.png" alt="Nmap Results" /></p>
        <p>Gobuster:</p>
        <p><img src="./media/image7.png" alt="Gobuster Results" /></p>
        <p>The <code>index.html</code> page states the site is under development, and there's a <code>login.html</code>
          view with this:</p>
        <p><img src="./media/image1.png" alt="Login Page" /></p>
        <p>The credentials don't work, but I remove the <code>type="password"</code> from the password field and save
          this user:pass just in case.</p>
        <p>Entering <code>'</code> in the username triggers a SQL error, confirming vulnerability. Since it appears to
          be blind injection (<code>OR 1=1;#</code> returns nothing), I use <code>sqlmap</code> directly:</p>
        <p><img src="./media/image5.png" alt="SQLMap Run" /></p>
        <p>I find a users table in the <code>users</code> database:</p>
        <p><img src="./media/image4.png" alt="Users Table" /></p>
        <p>Dumping the data reveals credentials:</p>
        <p><img src="./media/image6.png" alt="Dumped Data 1" /></p>
        <p><img src="./media/image8.png" alt="Dumped Data 2" /></p>
        <p>I successfully log in via SSH as <code>pepe</code> with his password. Checking <code>sudo -l</code> reveals
          nothing useful:</p>
        <p><img src="./media/image9.png" alt="Sudo -l" /></p>
        <p>XD</p>
        <p>Searching for SUID binaries, I find <code>grep</code> has the SUID bit set. This allows me to read sensitive
          files like <code>/etc/shadow</code> or root's <code>id_rsa</code> if it existed.</p>
        <p><img src="./media/image2.png" alt="SUID Grep" /></p>
        <p>It seems there's no <code>id_rsa</code>, but in <code>/etc/shadow</code> we see root's hashed password. I try
          cracking it with <code>john --format=crypt</code> and <code>rockyou.txt</code>, which works with yescrypt
          ($y$). However, it doesn't seem crackable. I also check the credentials I found earlier, but they are empty.
        </p>
        <p>There's a <code>.dockerenv</code> in the root of the machine, but it's empty. Checking
          <code>ps -faux | grep root</code> shows nothing suspicious.</p>
        <p>I can't access <code>/root</code> directly, but I can perform an <code>ls</code> and I see a file
          <code>pass.hash</code>. I use <code>grep</code> to read it: <code>e43833c4c9d5ac444e16bb94715a75e4</code>.</p>
        <p>I try various ways to break the hash with web tools and <code>john</code>. Finally, CrackStation identifies
          it as MD5 and gives me the password: <code>Spongebob34</code>. I <code>su</code> to root and the challenge is
          complete.</p>
      </div>

      <div id="content-es" class="lang-content">
        <div class="machine-summary">
          <h2 data-i18n="summary-title">Resumen de Explotaci√≥n</h2>
          <p><strong>Resumen del proceso:</strong> Se descubri√≥ una vulnerabilidad de inyecci√≥n SQL ciega en el
            formulario de inicio de sesi√≥n de la web. Utilizando <code>sqlmap</code>, se extrajeron las credenciales de
            la base de datos, lo que permiti√≥ el acceso por SSH como el usuario <code>pepe</code>. Una vez dentro, se
            identific√≥ que el binario <code>grep</code> ten√≠a el bit SUID activo, permitiendo la lectura de archivos
            sensibles. Mediante esta capacidad, se list√≥ el contenido del directorio <code>/root</code>, encontrando un
            archivo <code>pass.hash</code>. El hash (MD5) fue crackeado mediante CrackStation, obteniendo la contrase√±a
            de root y permitiendo elevar privilegios.</p>
          <p><strong>Tecnolog√≠as/Exploits:</strong> Blind SQLi, SQLMap, SUID Grep, MD5 Crack.</p>
        </div>
        <hr class="summary-divider">
        <p>Nmap:</p>
        <p><img src="./media/image3.png" alt="Resultados de Nmap" /></p>
        <p>Gobuster:</p>
        <p><img src="./media/image7.png" alt="Resultados de Gobuster" /></p>
        <p>La p√°gina pone que est√° en desarrollo en <code>index.html</code> y tiene una vista <code>login.html</code>
          con esto:</p>
        <p><img src="./media/image1.png" alt="P√°gina de Login" /></p>
        <p>Los credenciales no sirven pero le quito el <code>type="password"</code> a la contrase√±a y me guardo este
          usuario:pass por si acaso.</p>
        <p>Pruebo a poner <code>'</code> en el usuario y veo que tira un error de SQL indicando inyecci√≥n. Parece
          inyecci√≥n ciega ya que <code>OR 1=1;#</code> no devuelve nada, as√≠ que voy directo con <code>sqlmap</code>:
        </p>
        <p><img src="./media/image5.png" alt="Ejecuci√≥n de SQLMap" /></p>
        <p>Veo que hay una tabla de usuarios en la base de datos <code>users</code>:</p>
        <p><img src="./media/image4.png" alt="Tabla de Usuarios" /></p>
        <p>Dumpeo los datos:</p>
        <p><img src="./media/image6.png" alt="Datos Dumpeados 1" /></p>
        <p><img src="./media/image8.png" alt="Datos Dumpeados 2" /></p>
        <p>Me los apunto y entro por SSH con <code>pepe</code> y su contrase√±a. <code>sudo -l</code> no reporta nada
          √∫til:</p>
        <p><img src="./media/image9.png" alt="Sudo -l" /></p>
        <p>Xd</p>
        <p>Miro los SUID y veo que <code>grep</code> lo tiene activo, lo que permite leer cualquier archivo del sistema
          como <code>/etc/shadow</code> o la <code>id_rsa</code> de root si la hubiera.</p>
        <p><img src="./media/image2.png" alt="SUID Grep" /></p>
        <p>Parece que no hay <code>id_rsa</code> pero en <code>/etc/shadow</code> vemos la contrase√±a hasheada de root.
          Pruebo a reventarla con <code>john --format=crypt</code> y el <code>rockyou.txt</code>, que funciona con
          yescrypt ($y$) que es lo que se usa aqu√≠. Pero parece que no se puede crackear. Pruebo con credenciales
          anteriores pero est√°n vac√≠os.</p>
        <p>Hay un <code>.dockerenv</code> en la ra√≠z de la m√°quina pero est√° vac√≠o. Miro
          <code>ps -faux | grep root</code> pero no veo nada sospechoso.</p>
        <p>No puedo acceder a <code>/root</code> pero s√≠ puedo hacer <code>ls</code> y veo un archivo
          <code>pass.hash</code>. Tiro del <code>grep</code> para leerlo: <code>e43833c4c9d5ac444e16bb94715a75e4</code>.
        </p>
        <p>Pruebo varias maneras de romper el hash con webs y <code>john</code>, sin una manera clara. Finalmente
          CrackStation me dice que es MD5 y me da la pass: <code>Spongebob34</code>. Hago <code>su</code> a root y he
          ganado.</p>
      </div>
    </article>
  </main>
  <script src="../../index.js"></script>
</body>

</html>